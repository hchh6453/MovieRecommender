# 🎬 電影推薦 LINE Bot

一個結合 Gemini AI 的智能電影推薦 LINE Bot，能夠理解自然語言並提供個人化電影推薦。

## ✨ 功能特色

- 🤖 **智能對話**: 使用 Google Gemini AI 理解使用者需求
- 🎯 **個人化推薦**: 基於內容的電影推薦引擎
- 📱 **LINE Bot 整合**: 友善的聊天介面
- 🎨 **精簡卡片**: 使用文字導向的 Flex Message 展示電影資訊
- 🔍 **智能電影搜尋**: 精確匹配電影並顯示完整詳細資訊與電影大綱
- ⚡ **快速回應**: 高效的推薦算法
- 🧩 **外部資料整合**: 透過 TMDb/OMDb 取得片長、演員、預告片與串流平台資訊
- 🎭 **豐富資訊**: 顯示主要演員、YouTube 預告片連結、可觀看平台
- 📺 **串流平台過濾**: 可依 Netflix、Disney+、Amazon Prime Video、Apple TV+、HBO Max、Hulu、Catchplay 過濾推薦
- 📝 **使用者新增電影**: 支援提交新電影資訊，含 AI 安全驗證與頻率限制
- 🔄 **申訴機制**: 被拒絕的提交可申請管理員重新審核
- 🛡️ **安全驗證**: 多層 AI 驗證機制，確保提交內容安全

## 🏗️ 系統架構

```
使用者 (LINE App) → LINE Messaging API → FastAPI → 推薦引擎 + Gemini AI
```

## 🚀 快速開始

### 1. 環境設定

```bash
# 克隆專案
git clone https://github.com/hchh6453/MovieRecommender.git
cd MovieRecommender

# 建立虛擬環境
python -m venv venv
source venv/bin/activate  # macOS/Linux
# venv\Scripts\activate   # Windows

# 安裝依賴
pip install -r requirements.txt
```

### 2. 設定環境變數

```bash
# 複製環境變數範例
cp .env.example .env

# 編輯 .env 檔案，填入你的 API 金鑰
nano .env
```

### 3. 啟動服務

```bash
# 啟動開發服務器
python run.py

# 或使用 uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## 📁 專案結構

```
MovieRecommenderSystem/
├── app/                     # 主要應用程式
│   ├── main.py             # FastAPI 主程式
│   ├── config.py           # 設定檔
│   ├── services/           # 業務邏輯服務
│   ├── handlers/           # 訊息處理器
│   ├── models/             # 資料模型
│   └── utils/              # 工具函數
├── data/                   # 資料檔案
├── notebooks/              # Jupyter notebooks
├── requirements.txt        # Python 依賴
├── .env                   # 環境變數 (需自行建立)
└── README.md              # 專案說明
```

## 🔧 主要組件

### LINE Bot Service
- 處理 LINE Messaging API 整合
- 管理 Webhook 事件
- 生成 Flex Message 卡片

### Gemini AI Service
- 自然語言理解
- 使用者偏好提取
- 智能對話生成

### Recommendation Engine
- 基於內容的推薦算法
- 電影相似度計算
- 個人化推薦邏輯

### Movie Metadata Service
- TMDb API 整合（片長、演員、預告片、串流平台）
- OMDb API 備援（片長）
- 資料快取機制（減少外部 API 呼叫）

### Movie Submission Service
- 使用者提交電影資訊驗證
- AI 安全與真實性檢查
- 提交頻率限制（24小時內最多3次）
- 申訴暫存區管理
- 管理員審核工具

## 🎯 使用範例

```
使用者: "我想看一些輕鬆的喜劇電影"
Bot: [顯示喜劇電影推薦卡片]

使用者: "搜尋 玩具總動員"
Bot: [顯示完整電影資訊：年份、類型、片長、評分、電影大綱]

使用者: "搜尋 不存在的電影"
Bot: [告知找不到，推薦類似電影，提供新增電影指南]

使用者: "新增電影：我的新電影 (2024)\n類型：動作|科幻"
Bot: [AI 驗證後提交，顯示審核狀態]

使用者: "再推薦一些"
Bot: [基於對話歷史提供更多推薦]
```

## 📚 功能說明

### 已實現的功能

- ✅ **個人化推薦**: 系統會記住用戶喜好並提供個人化推薦
- ✅ **年份篩選**: 支援按年份推薦電影
- ✅ **類型篩選**: 支援指定或排除電影類型
- ✅ **質量排序**: 結合評分和評分人數進行排序
- ✅ **偏好管理**: 查看、重置個人偏好設定
- ✅ **操作指示**: 隨時查詢功能和使用方法
- ✅ **中文類型**: 電影類型自動翻譯為繁體中文
- ✅ **詳細資訊**: 點擊可查看電影詳細資訊（年份、類型、評分、片長、演員、預告片、串流平台）與 AI 推薦原因
- ✅ **外部資料整合**: 
  - 片長：以 TMDb 優先、OMDb 備援取得並寫入快取
  - 演員名單：顯示前 5 名主要演員
  - 預告片：自動取得 YouTube 預告片連結
  - 串流平台：顯示台灣地區可觀看的平台（訂閱/租借/購買）
 - ✅ **串流平台推薦**: 對話中指定平台關鍵字時，僅回傳該平台可觀看的電影
- ✅ **智能搜尋功能**: 
  - 精確匹配電影並顯示完整詳細資訊
  - 自動生成電影大綱（不劇透）
  - 找不到時推薦類似電影並提供新增指南
  - 記錄搜尋行為用於個人化
- ✅ **使用者新增電影**:
  - 支援提交新電影資訊
  - AI 多層安全驗證（安全性、真實性、合理性）
  - 提交頻率限制（24小時內最多3次）
  - 申訴機制（被拒絕可申請管理員審核）
  - 審核流程（管理員工具可審核申訴）

### 常用指令（聊天中直接輸入）

```
推薦 喜劇               → 推薦喜劇電影
2023年的電影            → 推薦 2023 年評分最高的電影
不要恐怖片              → 之後的推薦排除恐怖類型
查看偏好                → 顯示目前已儲存的喜好與排除類型
重置偏好                → 清空已儲存的個人偏好
怎麼用 / 幫助 / help     → 顯示完整使用說明
搜尋 玩具總動員          → 顯示完整電影資訊（年份/類型/片長/評分/電影大綱）
搜尋 不存在的電影        → 告知找不到，推薦類似電影，提供新增指南
電影資訊 玩具總動員      → 顯示該片詳細資訊（含年份/類型/評分/片長/演員/預告片/串流平台/理由）
Netflix 可以看的動作片    → 僅推薦 Netflix 可看之動作片
Disney+ 喜劇              → 僅推薦 Disney+ 可看之喜劇
有預告片嗎？              → 在「更多資訊」後針對該片提問（亦可問演員/平台）
新增電影：電影名稱 (年份)
類型：動作|喜劇           → 提交新電影資訊（AI 驗證後審核）
怎麼新增電影              → 查看提交格式說明
申訴                      → 申請管理員重新審核被拒絕的提交
```

### 使用範例

```
用戶: "我想看喜劇電影"
→ 推薦喜劇類型電影

用戶: "2023年的電影"
→ 推薦2023年評分最高的電影

用戶: "我不喜歡恐怖片"
→ 自動排除恐怖電影

用戶: "查看偏好"
→ 顯示目前的偏好設定

用戶: "怎麼用"
→ 顯示完整操作說明
```

## 📊 資料集

- `data/movies.csv`: 電影基本資訊
- `data/tags.csv`: 使用者標籤資料


## 🚀 部署

### 使用 Docker

```bash
# 建立 Docker 映像
docker build -t movie-recommender-bot .

# 執行容器
docker run -p 8000:8000 --env-file .env movie-recommender-bot
```

### 雲端部署

支援部署到：
- Google Cloud Run
- Heroku
- Railway
- AWS Lambda


## 📈 監控

- 健康檢查端點: `/health`
- API 文檔: `/docs`
- 日誌輸出: 控制台 + 檔案


## 🛡️ AI 判斷標準說明

系統使用 Google Gemini AI 驗證使用者提交的電影資訊，從以下面向檢查：

### 檢查項目
1. **安全性**：是否包含惡意內容、垃圾資訊、廣告、連結、個人資訊
2. **真實性**：是否像真實存在的電影（標題、類型、年份搭配是否合理）
3. **合理性**：內容是否符合電影資訊的格式和常見結構
4. **惡意行為**：是否有誤導、垃圾訊息、重複提交等跡象

### 驗證標準（保守策略）
- **允許提交**：只有 AI 非常確定（confidence ≥ 80%）資訊是安全且真實的
- **拒絕提交**：不確定、可疑、不安全的內容全部拒絕，優先保護系統安全

### 申訴機制
- 如果提交被拒絕但認為是誤判，可以回覆「申訴」
- 申訴後會進入管理員審核列表
- 管理員可使用 `review_appeals.py` 工具審核申訴

詳細說明請參考 [docs/AI_VALIDATION_STANDARDS.md](./docs/AI_VALIDATION_STANDARDS.md)

## 📄 授權

MIT License

---

**Happy Coding! 🎬✨**



